<!-- The SVG and Airplane div -->
<!-- The SVG and Airplane div -->
<svg id="cursorLineSVG" width="100%" height="100%"></svg>
<div id="airplaneWrapper">
  <div id="airplaneCursor">
    <svg
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clip-path="url(#clip0_63_31)">
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M19.9346 12.1629L11.2263 5.69686C11.2913 4.69723 11.3343 2.46515 11.2968 2.05083C10.982 -1.4223 8.78925 0.0748811 8.76812 1.62502C8.76234 2.04899 8.68526 4.24196 8.67731 5.70607L0.0760134 12.3314L0.0521224 14.4042L8.93006 10.3471L9.24753 16.7925L6.6728 18.6352L6.65574 19.9916L10.0517 19.059L10.0523 19.0702L13.4828 19.945L13.4426 18.5898L10.8367 16.793L11.0497 10.3425L19.9926 14.2318L19.9346 12.1629Z"
          fill="black"
        />
      </g>
      <defs>
        <clipPath id="clip0_63_31">
          <rect width="20" height="20" fill="white" />
        </clipPath>
      </defs>
    </svg>
  </div>
</div>
<!-- Styles and Script -->
<style>
  body {
    cursor: none; /* Hide the default cursor */
  }
  svg {
    position: absolute;
    top: 0;
    left: 0;
  }
  #airplaneWrapper {
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }
  #airplaneCursor {
    position: relative;
    user-select: none; /* Prevent text selection when dragging */
    font-size: 20px;
    color: black;
    transition: transform 0.2s; /* Smooth transition for rotation */
    width: 20px; /* Width of the SVG */
    height: 20px; /* Height of the SVG */
  }

  #airplaneCursor svg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(90deg);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const svg = document.getElementById("cursorLineSVG");
    const airplaneWrapper = document.getElementById("airplaneWrapper");
    const airplaneCursor = document.getElementById("airplaneCursor");
    let lastPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    let targetPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    let easeFactor = 0.13;

    function createLineElement(x1, y1, x2, y2) {
      const ns = "http://www.w3.org/2000/svg";
      const line = document.createElementNS(ns, "line");
      line.setAttribute("x1", x1);
      line.setAttribute("y1", y1);
      line.setAttribute("x2", x2);
      line.setAttribute("y2", y2);
      line.setAttribute("stroke", "black");
      line.setAttribute("stroke-width", "1");
      line.style.opacity = "1";
      return line;
    }

    function startFading(line) {
      const fadeInterval = setInterval(() => {
        if (parseFloat(line.style.opacity) <= 0) {
          svg.removeChild(line);
          clearInterval(fadeInterval);
        } else {
          line.style.opacity = parseFloat(line.style.opacity) - 0.01;
        }
      }, 1); // Adjusted for desired fade speed
    }

    let lastDelta = null;
    let lastAngle = 0;

    function smoothTransition(oldAngle, newAngle, alpha) {
      var diff = ((newAngle - oldAngle + 180 + 360) % 360) - 180;
      return oldAngle + diff * alpha;
    }

    document.addEventListener("mousemove", (event) => {
      targetPos = { x: event.clientX, y: event.clientY };
    });

    function animate() {
      if (lastPos) {
        let dx = targetPos.x - lastPos.x;
        let dy = targetPos.y - lastPos.y;

        if (Math.abs(dx) > 1 || Math.abs(dy) > 1) {
          const newPosX = lastPos.x + dx * easeFactor;
          const newPosY = lastPos.y + dy * easeFactor;

          const line = createLineElement(
            lastPos.x,
            lastPos.y,
            newPosX,
            newPosY
          );
          svg.appendChild(line);
          startFading(line);

          // Create and append the second line
          const line2 = createLineElement(
            lastPos.x - 10,
            lastPos.y,
            newPosX - 10,
            newPosY
          );
          svg.appendChild(line2);
          startFading(line2);

          lastPos.x = newPosX;
          lastPos.y = newPosY;
          lastDelta = { dx, dy };
        }

        let angle;
        if (lastDelta) {
          angle = Math.atan2(lastDelta.dy, lastDelta.dx) * (180 / Math.PI);
          if (angle < 0) angle += 360;
        } else {
          angle = lastAngle;
        }

        angle = smoothTransition(lastAngle, angle, 2.0);
        lastAngle = angle;

        airplaneWrapper.style.left = lastPos.x + "px";
        airplaneWrapper.style.top = lastPos.y + "px";
        airplaneCursor.style.transform = `rotate(${angle}deg) scale(4.5)`;
      } else {
        lastPos = { x: targetPos.x, y: targetPos.y };
      }
      requestAnimationFrame(animate);
    }
    animate();
  });
</script>
